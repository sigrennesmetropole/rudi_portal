<mat-sidenav-container>
    <!--  Liste des filtres-->
    <mat-sidenav #sidenav (keydown.escape)="sidenav.close()" disableClose>
        <app-filter-sidenav-container (close)="sidenav.close()" titleKey="filterBox.filtres">
            <p (click)="deleteAllFilters()" class="filter-link ml-0 py-2">{{'filterBox.toutEffacer'|translate}}</p>

            <div (click)="sidenavOrder.open(); sidenav.close()" class="rudi-sidenav-container-filter">
                {{'sortBox.sort'|translate}}
                <div>
                    <mat-icon [matBadge]="orderForm.counter$ | async" aria-hidden="false" aria-label="close icon"
                              class="toolbar-icon pointer">chevron_right
                    </mat-icon>
                </div>
            </div>

            <div (click)="sidenavThemes.open(); sidenav.close()" class="rudi-sidenav-container-filter">
                {{'filterBox.thematique'|translate}}
                <div>
                    <mat-icon [matBadge]="themesForm.counter$ | async" aria-hidden="false" aria-label="close icon"
                              class="toolbar-icon pointer">chevron_right
                    </mat-icon>
                </div>
            </div>

            <div (click)="sidenavProducerNames.open(); sidenav.close()" class="rudi-sidenav-container-filter">
                {{'filterBox.producteur'|translate}}
                <div>
                    <mat-icon [matBadge]="producerNamesForm.counter$ | async" aria-hidden="false" aria-label="close icon"
                              class="toolbar-icon pointer">chevron_right
                    </mat-icon>
                </div>
            </div>

            <div (click)="sidenavDates.open(); sidenav.close()" class="rudi-sidenav-container-filter">
                {{'filterBox.periode'|translate}}
                <div>
                    <mat-icon [matBadge]="datesForm.counter$ | async" aria-hidden="false" aria-label="close icon"
                              class="toolbar-icon pointer">chevron_right
                    </mat-icon>
                </div>
            </div>

            <div (click)="sidenavRestrictedAccess.open(); sidenav.close()" class="rudi-sidenav-container-filter">
                {{'filterBox.restrictedAccess.title'|translate}}
                <div>
                    <mat-icon [matBadge]="restrictedAccessForm.counter$ | async" aria-hidden="false" aria-label="close icon"
                              class="toolbar-icon pointer">chevron_right
                    </mat-icon>
                </div>
            </div>

            <div class="rudi-sidenav-container-footer mt-5">
                <button
                    (click)="submitFilters()"
                    class="rudi-blue-large-button"
                    mat-raised-button>
                    {{'filterBox.valider'|translate}}
                </button>
            </div>
        </app-filter-sidenav-container>
    </mat-sidenav>

    <mat-sidenav #sidenavOrder (keydown.escape)="sidenav.close()" disableClose>
        <app-filter-sidenav-container (close)="orderForm.revert(); sidenavOrder.close(); sidenav.open()" titleKey="sortBox.sort">
            <app-order-filter-form
                #orderForm
                [values]="orders"
                (submit)="sidenavOrder.close()"
                ulClass="pl-5">
            </app-order-filter-form>
        </app-filter-sidenav-container>
    </mat-sidenav>

    <mat-sidenav #sidenavThemes (keydown.escape)="sidenav.close()" disableClose>
        <app-filter-sidenav-container (close)="themesForm.revert(); sidenavThemes.close(); sidenav.open()" titleKey="filterBox.thematique">
            <app-themes-filter-form
                #themesForm
                (selectedItemsChange)="selectedThemeItems = $event"
                (submit)="sidenavThemes.close()"
                [values]="themes"
                ulClass="pl-5">
            </app-themes-filter-form>
        </app-filter-sidenav-container>
    </mat-sidenav>

    <mat-sidenav #sidenavProducerNames (keydown.escape)="sidenav.close()" disableClose>
        <app-filter-sidenav-container (close)="producerNamesForm.revert(); sidenavProducerNames.close(); sidenav.open()"
                                      titleKey="filterBox.producteur">
            <app-producer-names-filter-form
                #producerNamesForm
                (selectedItemsChange)="selectedProducerItems = $event"
                (submit)="sidenavProducerNames.close()"
                [values]="producerNames"
                ulClass="pl-5">
            </app-producer-names-filter-form>
        </app-filter-sidenav-container>
    </mat-sidenav>

    <mat-sidenav #sidenavDates (keydown.escape)="sidenav.close()" disableClose>
        <app-filter-sidenav-container (close)="datesForm.revert(); sidenavDates.close(); sidenav.open()" titleKey="filterBox.periode">
            <app-dates-filter-form
                #datesForm
                (selectedItemsChange)="selectedDatesItems = $event"
                (submit)="sidenavDates.close()"
                debutDivClass="d-flex"
                finDivClass="d-flex mt-3"
                formClass="d-flex flex-column justify-content-center"
                ulClass="pl-5"
            >
            </app-dates-filter-form>
        </app-filter-sidenav-container>
    </mat-sidenav>

    <mat-sidenav #sidenavRestrictedAccess (keydown.escape)="sidenav.close()" disableClose>
        <app-filter-sidenav-container (close)="restrictedAccessForm.revert(); sidenavRestrictedAccess.close(); sidenav.open()"
                                      titleKey="filterBox.restrictedAccess.title">
            <app-restricted-access-filter-form
                #restrictedAccessForm
                (selectedItemsChange)="selectedRestrictedAccessItems = $event"
                (submit)="sidenavRestrictedAccess.close()"
                ulClass="pl-5">
            </app-restricted-access-filter-form>
        </app-filter-sidenav-container>
    </mat-sidenav>

    <mat-sidenav-content>

        <div [ngClass]="{'p-small': mediaSize.isSm === true, 'p-medium': mediaSize.isMd, 'p-large':mediaSize.isLg || mediaSize.isXl || mediaSize.isXxl}"
             class="container-fluid">

            <!--Composant de recherche libre-->
            <app-search-box
                [mediaSize]="mediaSize"
                class="d-flex justify-content-center w-100"
            ></app-search-box>

            <app-filters
                (selectedDatesItemsChange)="selectedDatesItems = $event"
                (selectedProducerItemsChange)="selectedProducerItems = $event"
                (selectedRestrictedAccessItemsChange)="selectedRestrictedAccessItems = $event"
                (selectedThemeItemsChange)="selectedThemeItems = $event"
                [mediaSize]="mediaSize"
                [producerNames]="producerNames"
                [themes]="themes"
            ></app-filters>

            <app-filters-items-list
                [selectedDatesItems]="selectedDatesItems"
                [selectedProducerItems]="selectedProducerItems"
                [selectedRestrictedAccessItems]="selectedRestrictedAccessItems"
                [selectedThemeItems]="selectedThemeItems"
            >
            </app-filters-items-list>

            <div [ngClass]="{'data-set-full-height-sm': mediaSize.isXs || mediaSize.isSm || mediaSize.isMd }"
                 class="data-set-full-height">

                <div class="d-flex py-3 justify-content-between">
                    <!--Nombre de résultats-->
                    <div class=" w-50 search-count">
                        <ng-container *ngIf="searchIsRunning">
                            {{'searchbox.searchIsRunning'|translate}}
                        </ng-container>
                        <ng-container *ngIf="!searchIsRunning">
                            {{metadataList.total}} {{'searchbox.resultats'|translate}}{{metadataList.total > 1 ? 's' : ''}}
                        </ng-container>
                        <span *ngIf="searche$ | async">{{'searchbox.pour'|translate}} "{{searche$ | async}}"</span>
                    </div>

                    <!--Composant de tri-->
                    <app-order
                        [values]="orders"
                        *ngIf="mediaSize.isXl || mediaSize.isLg || mediaSize.isXxl"
                    >
                    </app-order>

                    <!--Ouverture des filtres en mode mobile-->
                    <div
                        (click)="openSidenav()"
                        *ngIf="mediaSize.isXs || mediaSize.isMd || mediaSize.isSm"
                        class="rudi-filter-box pointer w-50 d-flex justify-content-end align-items-center blue-theme">
                        <ng-container *ngIf="!this.isFiltered" class="container-filter-box">
                            <mat-icon [ngClass]="this.isFiltered ? 'rudi-icon-bordered' : ''" aria-hidden="false"
                                      aria-label="filter icon"
                                      class="pointer mr-1 font-weight-bold">tune
                            </mat-icon>
                            <span class="rudi-filter-box-libelle">{{'filterBox.filtrer'|translate}}</span>
                        </ng-container>
                        <button *ngIf="this.isFiltered" class="rudi-icon-bordered" color="primary" mat-flat-button>
                            <mat-icon aria-hidden="false" aria-label="filter icon "
                                      class="pointer mr-1 font-weight-bold">tune
                            </mat-icon>
                            <span class="rudi-filter-box-libelle-hover">{{'filterBox.filtres'|translate}}</span>
                        </button>
                    </div>
                    <!---------------------------------------->
                </div>
                <div class="content">
                    <div fxLayout="row wrap">
                        <div
                            *ngFor="let metadata of metadataList.items | paginate: {
              itemsPerPage: limit,
              currentPage: page,
              totalItems: metadataList.total
            }"
                            [ngClass]="{'data-set-container-sm': mediaSize.isXs || mediaSize.isSm || mediaSize.isMd, 'data-set-container-lg':  mediaSize.isLg,
        'data-set-container-xl': mediaSize.isXl, 'data-set-container-xxl': mediaSize.isXxl}"
                        >
                            <app-data-set-card
                                (click)="onClickOnRowDataSet(metadata)"
                                [metadata]="metadata"
                                [themePicto]="getThemePictoFor(metadata)"
                                [themeLabel]="getThemeLabelFor(metadata)"
                            ></app-data-set-card>
                        </div>

                    </div>
                </div>
                <!-- Pagination des jdd -->

                <pagination-controls
                    (pageChange)="handlePageChange($event)"
                    [maxSize]="mediaSize.isSm ? maxPageSm : maxPageLg"
                    class="d-flex justify-content-center mt-4 pagination-font-size pagination-container"
                    nextLabel="Suivant"
                    previousLabel="Précédent">
                </pagination-controls>

            </div>
        </div>

    </mat-sidenav-content>
</mat-sidenav-container>
